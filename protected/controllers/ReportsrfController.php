<?phpclass ReportsrfController extends Controller{	/**	 * @var string the default layout for the views. Defaults to '//layouts/column2', meaning	 * using two-column layout. See 'protected/views/layouts/column2.php'.	 */	public $layout='//layouts/column2';protected $menuname = 'reportsrf';public function actionIndex()	{            parent::actionIndex();		//$model=new Reportsrf('search');		//$model->unsetAttributes();  // clear any default values		//if(isset($_GET['Reportsrf']))		//	$model->attributes=$_GET['Reportsrf'];		//if (isset($_GET['pageSize']))		//  {		//	Yii::app()->user->setState('pageSize',(int)$_GET['pageSize']);		//	unset($_GET['pageSize']);  // would interfere with pager and repetitive page size change		//  }		$this->render('index');	}		public function actionDownload()  {  parent::actionDownload();   $sql = "SELECT a.projectno,c.fullname,a.projectnote,d.servicetypename,a.priceotc,a.priceotrFROM project aLEFT JOIN soheader b ON b.soheaderid = a.soheaderidLEFT JOIN employee c ON c.employeeid = b.employeeidLEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeidWHERE a.projectno != '' ";				$command=$this->connection->createCommand($sql);		$dataReader=$command->queryAll();    $this->pdf->title='Report All SRF';		$this->pdf->AddPage('L');		$this->pdf->setFont('Arial','B',12);		// definisi font		$this->pdf->setFont('Arial','B',8);		$this->pdf->setaligns(array('C','C','C','C','C'));		$this->pdf->setwidths(array(35,50,50,30,35,35));		$this->pdf->Row(array('SRF No','Sales','Note','Service Type','Biaya Awal','Biaya Per Bulan'));		$this->pdf->setaligns(array('C','C','C','C','R','R'));		foreach($dataReader as $row1)		{		  		  $this->pdf->row(array($row1['projectno'],$row1['fullname'],		  $row1['projectnote'],$row1['servicetypename'],		  		   Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row1['priceotc']),		  Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row1['priceotr']),		  ));		}				$sql1 = "SELECT sum(a.priceotc) as totalb,sum(a.priceotr) as totalFROM project aLEFT JOIN soheader b ON b.soheaderid = a.soheaderidLEFT JOIN employee c ON c.employeeid = b.employeeidLEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeidWHERE a.projectno != ''";				$command1=$this->connection->createCommand($sql1);		$dataReader1=$command1->queryAll();		foreach($dataReader1 as $row2)		{		  $this->pdf->row(array(				'','','','','Total Pendapatan',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row2['total']),		  ));		}				$sql22 = "SELECT a.sono, a.sodate, b.fullname,  a.contractno, a.startdate, a.enddate, a.projectvalue, c.projecttypecode, a.projectname, a.personincharge, d.fullname AS employeename, e.currencyname, f.servicetypenameFROM soheader aLEFT JOIN addressbook b ON b.addressbookid = a.addressbookidLEFT JOIN projecttype c ON c.projecttypeid = a.projecttypeidLEFT JOIN employee d ON d.employeeid = a.employeeidLEFT JOIN currency e ON e.currencyid = a.currencyidLEFT JOIN servicetype f ON f.servicetypeid = a.servicetypeid WHERE a.sono != ''";				$command=$this->connection->createCommand($sql22);		$dataReader=$command->queryAll();    $this->pdf->title='Sales Order List';		$this->pdf->Ln();		$this->pdf->setFont('Arial','B',12);		// definisi font		$this->pdf->setFont('Arial','B',8);		$this->pdf->setaligns(array('C','C','C','C','C'));		$this->pdf->setwidths(array(45,70,50,35,35));		$this->pdf->Row(array('SO No','Customer','Sales','Service Type','Project Value'));		$this->pdf->setaligns(array('C','C','C','R','R'));		foreach($dataReader as $row1)		{		  		  $this->pdf->row(array($row1['sono'],$row1['fullname'],		  $row1['employeename'],$row1['servicetypename'],		  Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row1['projectvalue']),		  ));		}				$sql221 = "SELECT SUM( projectvalue ) AS total FROM soheader";				$command1=$this->connection->createCommand($sql221);		$dataReader1=$command1->queryAll();		foreach($dataReader1 as $row3)		{		  $this->pdf->row(array(				'','','','Total Pendapatan',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row3['total']),		  ));		}						//untuk total seluruh		$this->pdf->Ln();		$tot1 = $row2['total'];		$tot2 = $row3['total'];		$tota = $row2['totalb'];		$totb = $tot1+$tot2;		$tots = $tot1 + $tot2+$row2['totalb'];		$this->pdf->row(array('Total Biaya Awal',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$tota)));		$this->pdf->row(array('Total Perbulan',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$totb)));		$this->pdf->row(array('Total Penghasilan',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$tots)));		// me-render ke browser		$this->pdf->Output();  }    public function actionDownloaddetailservice()  {		parent::actionDownload();		$sql = "SELECT a.projectno,c.fullname,a.projectnote,d.servicetypename,a.priceotc,a.priceotr		FROM project a		LEFT JOIN soheader b ON b.soheaderid = a.soheaderid		LEFT JOIN employee c ON c.employeeid = b.employeeid		LEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeid		WHERE a.projectno != '' and b.servicetypeid=1";				$command=$this->connection->createCommand($sql);		$dataReader=$command->queryAll();		$this->pdf->title='Report SRF Detail Service Type';		$this->pdf->AddPage('L');		$this->pdf->setFont('Arial','B',12);		// definisi font		$this->pdf->setFont('Arial','B',8);				$this->pdf->setaligns(array('C','C','C','C','C'));		$this->pdf->setwidths(array(35,50,50,30,35,35));		$this->pdf->Row(array('SRF No','Sales','Note','Service Type','Biaya Awal','Biaya Per Bulan'));		$this->pdf->setaligns(array('C','C','C','C','R','R'));		foreach($dataReader as $row1)		{		  		  $this->pdf->row(array($row1['projectno'],$row1['fullname'],		  $row1['projectnote'],$row1['servicetypename'],		  		   Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row1['priceotc']),		  Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row1['priceotr']),		  ));		}		$this->pdf->Ln();		$sql1 = "SELECT a.projectno,c.fullname,a.projectnote,d.servicetypename,a.priceotc,a.priceotr		FROM project a		LEFT JOIN soheader b ON b.soheaderid = a.soheaderid		LEFT JOIN employee c ON c.employeeid = b.employeeid		LEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeid		WHERE a.projectno != '' and b.servicetypeid=2";				$command1=$this->connection->createCommand($sql1);		$dataReader1=$command1->queryAll();				// definisi font		$this->pdf->setFont('Arial','B',8);					$this->pdf->setaligns(array('C','C','C','C','C'));		$this->pdf->setwidths(array(35,50,50,30,35,35));		$this->pdf->Row(array('SRF No','Sales','Note','Service Type','Biaya Awal','Biaya Per Bulan'));		$this->pdf->setaligns(array('C','C','C','C','R','R'));				foreach($dataReader1 as $row2)		{		  		  $this->pdf->row(array($row2['projectno'],$row2['fullname'],		  $row2['projectnote'],$row2['servicetypename'],		  		   Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row2['priceotc']),		  Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row2['priceotr']),		  ));		}				$this->pdf->Ln();		$sql2 = "SELECT a.projectno,c.fullname,a.projectnote,d.servicetypename,a.priceotc,a.priceotr		FROM project a		LEFT JOIN soheader b ON b.soheaderid = a.soheaderid		LEFT JOIN employee c ON c.employeeid = b.employeeid		LEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeid		WHERE a.projectno != '' and b.servicetypeid=3";				$command2=$this->connection->createCommand($sql2);		$dataReader2=$command2->queryAll();				// definisi font		$this->pdf->setFont('Arial','B',8);					$this->pdf->setaligns(array('C','C','C','C','C'));		$this->pdf->setwidths(array(35,50,50,30,35,35));		$this->pdf->Row(array('SRF No','Sales','Note','Service Type','Biaya Awal','Biaya Per Bulan'));		$this->pdf->setaligns(array('C','C','C','C','R','R'));				foreach($dataReader2 as $row3)		{		  		  $this->pdf->row(array($row3['projectno'],$row3['fullname'],		  $row3['projectnote'],$row3['servicetypename'],		  		   Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row3['priceotc']),		  Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row3['priceotr']),		  ));		}						//cari sub total		$sql11 = "SELECT SUM(a.priceotr) as totala, sum(a.priceotc) as totalb		FROM project a		LEFT JOIN soheader b ON b.soheaderid = a.soheaderid		LEFT JOIN employee c ON c.employeeid = b.employeeid		LEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeid		WHERE a.projectno != '' and b.servicetypeid=1";				$command11=$this->connection->createCommand($sql11);		$dataReader11=$command11->queryAll();		foreach($dataReader11 as $row11)		{			$row11['totala'];			$row11['totalb'];		}		$sql22 = "SELECT SUM(a.priceotr) as totala, sum(a.priceotc) as totalb		FROM project a		LEFT JOIN soheader b ON b.soheaderid = a.soheaderid		LEFT JOIN employee c ON c.employeeid = b.employeeid		LEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeid		WHERE a.projectno != '' and b.servicetypeid=2";				$command22=$this->connection->createCommand($sql22);		$dataReader22=$command22->queryAll();		foreach($dataReader22 as $row22)		{			$row22['totala'];			$row22['totalb'];		}				$sql33 = "SELECT SUM(a.priceotr) as totala, sum(a.priceotc) as totalb		FROM project a		LEFT JOIN soheader b ON b.soheaderid = a.soheaderid		LEFT JOIN employee c ON c.employeeid = b.employeeid		LEFT JOIN servicetype d ON d.servicetypeid = b.servicetypeid		WHERE a.projectno != '' and b.servicetypeid=3";				$command33=$this->connection->createCommand($sql33);		$dataReader33=$command33->queryAll();		foreach($dataReader33 as $row33)		{			$row33['totala'];			$row33['totalb'];		}				//menjumlahkan total berdasarkan subtotal		$this->pdf->ln();		$this->pdf->ln();				$total = $row11['totala'] + $row22['totala'] + $row33['totala']; //+$row11['totalb']+$row22['totalb']+$row33['totalb'];		$this->pdf->row(array('Total Biaya Awal',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row11['totalb']+$row22['totalb']+$row33['totalb'])));		$this->pdf->row(array('Total Biaya Bulanan',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$total)));		$this->pdf->row(array('Total Seluruh',Yii::app()->numberFormatter->format(Yii::app()->params["defaultnumberqty"],$row11['totalb']+$row22['totalb']+$row33['totalb']+$total)));		$this->pdf->Output();  }}?>